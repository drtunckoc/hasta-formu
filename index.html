const generateAI = async () => {
                setLoading(true);
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: `Aşağıdaki hastayı bir omurga cerrahı için özetle: ${formData.adSoyad}, ${formData.yas}yaş, şikayet: ${formData.sikayetler.join(', ')}` }] }] })
                    });
                    
                    const data = await response.json();
                    
                    // --- TEŞHİS BÖLÜMÜ ---
                    if (data.error) {
                        console.error("API Hatası:", data.error.message);
                        alert("AI Hatası: " + data.error.message); // Ekrana gerçek hatayı basar
                        throw new Error(data.error.message);
                    }

                    if (data.candidates && data.candidates[0].content.parts[0].text) {
                        setAiSummary(data.candidates[0].content.parts[0].text);
                        setStep(6);
                    }
                } catch (e) {
                    setAiSummary("AI Özeti şu an hazır değil, ancak tüm veriler aşağıdadır.");
                    setStep(6);
                }
                setLoading(false);
            };
